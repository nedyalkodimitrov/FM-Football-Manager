{% extends 'player/base.html.twig' %}
 {% block nav %}
     <a class="nav-item nav-link   ml-2" href="#">Начална страница </a>
     <a class="nav-item nav-link current-item ml-2" href="{{ path("playerTraining") }}">Тренировки</a>

 {% endblock %}
{% block body%}
    <div class="container row mt-3 col-12 justify-content-between max-resolution mb-5">
        <table class="table col-lg-8 table-bordered col-sm-12 ">
            <thead class="bg-dark">
            <tr class=" color-white">
                <th scope="col ml-1 ml-sm-5">Пон</th>
                <th scope="col ml-1 ml-sm-5">Втор</th>
                <th scope="col ml-1 ml-sm-5">Сря</th>
                <th scope="col ml-1 ml-sm-5">Чет</th>
                <th scope="col ml-1 ml-sm-5">Пет</th>
                <th scope="col ml-1 ml-sm-5">Съб</th>
                <th scope="col ml-1 ml-sm-5">Нед</th>
            </tr>
            </thead>
            <tbody>
                <tr class="">
                    {% set j = 0 %}
                    {% for x in range(monday|date('U'), sunday|date('U'), 86400 ) %}
                        {% if  j < schedule|length  and schedule[j].date ==  x|date('d/m/Y')|trans   %}
                            {% if  j + 1 < schedule|length  and schedule[j+1].date ==  x|date('d/m/Y')|trans  %}
                                <td class="ml-1 mr-sm-5 col-1">
                                    {{ schedule[j].Description }} <br>{{ schedule[j].StartTime }}<br>
                                    {{ schedule[j + 1].Description }} <br>{{ schedule[j + 1].StartTime }}
                                </td>
                                {% set j = j + 1 %}
                            {% else %}
                                    <td class="ml-1 mr-sm-5 col-1">{{ schedule[j].Description }} <br>{{ schedule[j].StartTime }}</td>
                            {% endif %}

                            {% set j = j + 1 %}
                        {% else %}
                            <td class=" col-1 "><h6>Почивка</h6></td>

                            {% set j = j + 1 %}
                        {% endif %}
                    {% endfor %}

                </tr>
            </tbody>
        </table>
        <div class="container row col-lg-4 col-sm-12 justify-content-sm-center mt-sm-3 trainig-program text-center m-0 ">
            <div class="col-12 justify-content-center text-center">
                {% if bigCoache != null %}
                    <img src="{{asset("images/" ~ bigCoache.Image)}}" alt="" title="them's hoverin' words" class="coache_image "></label><br>
                    <h1 >{{ bigCoache.UserId.Name }} {{ bigCoache.UserId.FName}} </h1><br>
                    {% for schedules in schedule %}
                        {% if schedules.date == "now"|date()|trans %}
                            <p>schedules.date</p>
                        {% endif %}
                    {% endfor %}
                        <button class="btn bg-mycolor treatment">Пропускане на тренировка </button>
                {% else %}
                    <h2>Нямате главен треньор и съобщението може да не бъде видяно</h2>
                        <button class="btn bg-mycolor treatment">Пропускане на тренировка </button>


                {% endif %}

            </div>
        </div>
    </div>

    <div class="player-status-container row justify-content-center align-items-center">
        <div class="col-9 col-sm-10 player-status-div row align-items-center justify-content-center" id="treatment_info" >
            <h1 class="text-center">Пропускане на тренировка </h1>
            <div class="col-lg-8 col-sm-11  row justify-content-center">

                <div class="input-group mb-3 col-lg-6 col-sm-12">
                    <select class="form-control select bg-gray col-sm-12 " id="status" >
                        <option value="" selected="selected" disabled="disabled" class="bg-gray">Защо няма да може да доидете </option>
                        <option value="Семейни причини" class="bg-gray">Семеини причини</option>
                        <option value="Болен" class="bg-gray">Болен</option>
                        <option value="Контузен" class="bg-gray">Контузен</option>
                    </select>
                </div>
                <div class="input-group mb-3 col-lg-6 col-sm-12">
                    <input class="effect-2 bg-gray medicaments" type="text"  placeholder="Медиакменти" id="email" aria-label="Email" aria-describedby="basic-addon1" name="_username">
                    <span class="focus-border"></span>
                </div>
                <div class="input-group mb-4 mt-2 col-lg-6 col-sm-12">
                    <input class="effect-2 bg-gray startDate-input"  type="text" placeholder="Няма да съм на тренировки от..." id="email" aria-label="Email" aria-describedby="basic-addon1" name="_username">
                    <span class="focus-border"></span>
                </div>
                <div class="input-group mb-4 mt-2 col-lg-6 col-sm-12">
                    <input class="effect-2 bg-gray endDate-input"  type="text" placeholder="Няма да съм на тренировки до..." id="email" aria-label="Email" aria-describedby="basic-addon1" name="_username">
                    <span class="focus-border"></span>
                </div>
                <button class="btn bg-mycolor" id="send-info">Потвърди</button>

            </div>
            <span><i class="fas fa-times-circle" ></i></span>
        </div>
    </div>

    <div class="container row col-12 justify-content-between max-resolution">
        <table class="table table-bordered table-hover table-striped table-sm" id="appointment_list">
            <thead class="thead-dark">
            <tr>
                <th scope="col" class="text-center align-middle">Причина</th>
                <th scope="col" class="text-center align-middle">Медикаменти</th>
                <th scope="col" class="text-center align-middle">От</th>
                <th scope="col" class="text-center align-middle">До</th>
                <th scope="col" class="text-center align-middle">Action</th>
            </tr>
            </thead>

            {% for stat in status %}
                <tr class="{{ stat.Id }}">
                    <td scope="col" class="text-center align-middle">{{ stat.Status }}</td>
                    <td scope="col" class="text-center align-middle">{{ stat.Medicaments }}</td>
                    <td scope="col" class="text-center align-middle">{{ stat.startTreatment }}</td>
                    <td scope="col" class="text-center align-middle">{{ stat.endTreatment }}</td>
                    <td scope="col" class="text-center align-middle"><span id=""><i class="fa fa-times delete-injured" id="{{ stat.Id }}"  aria-hidden="true"></i></span></td>

                </tr>
            {% endfor %}
            <tbody>
            </tbody>
        </table>
    </div>





    <script>
        $('.treatment').on('click', function () {
            $('.player-status-container').css('visibility', 'visible');
            $('#treatment_info').css('visibility', 'visible');

            $('.fa-times-circle').on('click', function () {
                $('.player-status-container').css('visibility', 'hidden');
                $('#treatment_info').css('visibility', 'hidden');
            });


        });

        $('.delete-injured').on('click', function () {
            var statId =  $(this).attr('id');
            console.log(statId);
            $.ajax({
                method: "POST",
                url: "/player/deleteStat/"+statId,
            })
                .done(function( msg ) {
                    if (msg == 1){
                        iziToast.success({
                            title: '',
                            message: 'Вие успешно уведомихте треньора, че няма да ходите на тренировка',
                            position: 'topRight',
                        });
                        $('.' + statId).remove();
                    }


                });
        });


        $(".startDate-input").inputmask("dd/mm/yyyy", {
            placeholder: "dd/mm/YYYY",
            alias: "date",
            clearIncomplete: true
        });
        $(".endDate-input").inputmask("dd/mm/yyyy", {
            placeholder: "dd/mm/YYYY",
            alias: "date",
            clearIncomplete: true
        });


        $('.select').on('change', function () {
            if ($('.select').val == 'family'){
                console.log('1');

            }
        });

        $('#send-info').on('click', function () {
            var status = $('#status').val();
            var medicaments = $('.medicaments').val();
            var startTreatment = $('.startDate-input').val();
            var endTreatment = $('.endDate-input').val();



            var timeCheck = false;
            var statusCheck = false;
            var day = new Date();
            var dd = day.getDate();
            var mm = day.getMonth() + 1; //January is 0!
            var secondmm = day.getMonth() + 2;
            var yyyy = day.getFullYear();

            if (dd < 10) {
                dd = '0' + dd;
            }

            if (mm < 10) {
                mm = '0' + mm;
            }


            var start = startTreatment.split('/');
            var end = endTreatment.split('/');

            if(dd <= start[0] && mm<=start[1] && yyyy == start[2] && secondmm > start[1]  && start[0] <= end[0] && start[1] <= end[1] && end[1] <= secondmm && end[2]==yyyy){
                var timeCheck = true;
            }else {
                iziToast.warning({
                    title: 'Грешни данни',
                    message: "Неможе началната дата да е по-голяма от крайната",
                    overlay: true,
                    zindex: 999,
                    position: 'center',
                    timeout: 2000,
                });
            }
            if(status != 0){
                statusCheck = true;
            }else {
                iziToast.warning({
                    title: 'Грешни данни',
                    message: "Моля изберете причината, поради която ще отсъствате",
                    overlay: true,
                    zindex: 999,
                    position: 'center',
                    timeout: 2000,
                });
            }

            if (statusCheck == true && timeCheck == true){
                $.ajax({
                    method: "POST",
                    data: {"appbundle_playersinjured[status]": status, "appbundle_playersinjured[medicaments]": medicaments, "appbundle_playersinjured[startTreatment]": startTreatment, "appbundle_playersinjured[endTreatment]": endTreatment},
                    url: "{{ path('playerTraining') }}",
                })
                    .done(function( msg ) {
                        console.log(msg);
                        if(msg == 1){
                            iziToast.success({
                                title: '',
                                message: 'Вие успешно уведомихте треньора, че няма да ходите на тренировка',
                                position: 'topRight',
                            });
                        }else if(msg == 2){
                            iziToast.warning({
                                title: 'Грешка',
                                message: "Имате съвпадение в датите",
                                overlay: true,
                                zindex: 999,
                                position: 'center',
                                timeout: 20000,
                            });
                        }else{
                            iziToast.warning({
                                title: 'Грешка',
                                message: "Грешла при записването на данни",
                                overlay: true,
                                zindex: 999,
                                position: 'center',
                                timeout: 20000,
                            });
                        }
                        $('#status').val('');
                        $('.medicaments').val('');
                        $('.startDate-input').val('');
                        $('.endDate-input').val('');
                    });
            }
        });


    </script>
{% endblock %}